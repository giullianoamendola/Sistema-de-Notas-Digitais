(function(window){"use strict";function createCORSRequest(){var xhr=new XMLHttpRequest;if("withCredentials"in xhr){return xhr}else if(typeof XDomainRequest!="undefined"){return new XDomainRequest}else{return null}}var docCookies={getItem:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return this.hasItem(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return a?new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;b>c;c++)a[c]=decodeURIComponent(a[c]);return a}};var domain="http://www.clicrbs.com.br",endpoints={login:"/wrs/api/session",update:"/wrs/action/update/loadUser"};var serialize=function(obj){var str=[];for(var p in obj){if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}}return str.join("&")};var ajax=function(method,url,data,successCallback,failCallback){var request=new XMLHttpRequest;var timeout=5e3;request.open(method,url);if(method==="POST"){request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}request.onload=function(){if(request.status>=200&&request.status<400){var data=JSON.parse(request.responseText);if(typeof successCallback==="function"){successCallback(data)}}else{if(typeof failCallback==="function"){var parsedResponse=request.responseText.indexOf(":")!==-1?JSON.parse(request.responseText):"";failCallback(request.status,request.statusText,parsedResponse.status?parsedResponse.status:parsedResponse)}}};request.ontimeout=function(){if(typeof failCallback==="function"){var parsedResponse=request.responseText.indexOf(":")!==-1?JSON.parse(request.responseText):"";failCallback({error:true,type:"timeout",message:"Request fail, timeout."})}};if(typeof data===undefined||data===null){request.send()}else{data=serialize(data);request.send(data)}};var getLink=function(linksObj,relName){for(var i=0,linksLength=linksObj.length;i<linksLength;i++){if(linksObj[i].rel===relName){return linksObj[i].href}}};var getCookie=function(cookieName){var cookieList=document.cookie.split(";");for(var i=0;i<cookieList.length;i++){var currCookie=cookieList[i];while(currCookie.charAt(0)==" "){currCookie=currCookie.substring(1,currCookie.length)}if(currCookie.indexOf(cookieName)===0){return currCookie.substring(cookieName.length+1)}}};var setCookie=function(cookieName,value,expires){if(typeof expires!==undefined){value+="; expires="+expires}document.cookie=cookieName+"="+value+"; domain=.clicrbs.com.br; path=/;";document.cookie=cookieName+"="+value+"; path=/;"};var getExpirationDate=function(){var twoWeeksInMs=60*1e3*60*24*14;var today=Date.now();var twoWeeksFromNow=new Date(today+twoWeeksInMs);return twoWeeksFromNow.toUTCString()};var Wrs=function(){};Wrs.init=function(siteID){var instance=new this;instance.initialize(siteID);return instance};Wrs.prototype={settings:{siteID:null,links:{}},initialize:function(siteID){this.settings.siteID=siteID},login:function(email,password,keepUserLogged,successCallback,failCallback){var instance=this;ajax("POST",domain+endpoints.login,{userID:email,password:password,site:Wrs.prototype.settings.siteID,stayLogged:keepUserLogged},function loginSuccess(data){var status=data.status;var token=data.token;var expirationDate;if(keepUserLogged){expirationDate=getExpirationDate()}setCookie("wrs",encodeURIComponent(token),expirationDate);switch(status){case"STATUS_USER_AUTHENTICATED_DUPLICATED_ACCOUNT":window.location=domain+getLink(data._links,"normalize");break;case"STATUS_USER_AUTHENTICATED":instance.settings.links.userInfo=getLink(data._links,"user");break;default:break}if(typeof successCallback==="function"){successCallback(status,token)}},function loginFail(status,statusMsg,msg){if(typeof failCallback==="function"){failCallback(status,statusMsg,msg)}})},getUserInfo:function(callback){var instance=this;ajax("GET",domain+instance.settings.links.userInfo,null,function getUserInfoSuccess(data){instance.settings.links.subscriptions=getLink(data._links,"subscriptions");if(typeof callback==="function"){callback(data)}})},getUserSubscription:function(successCallback,failCallback,filter){var instance=this;var f=filter?"?jornal="+filter:"";ajax("GET",domain+instance.settings.links.subscriptions+f,null,function getUserSubscriptionSuccess(data){if(typeof successCallback==="function"){successCallback(data)}},function getUserSubscriptionFail(status,statusMsg,msg){if(typeof failCallback==="function"){failCallback(status,statusMsg,msg)}})},getLoggedUser:function(callback,failCallback){var instance=this;var cookie=docCookies.getItem("wrs");var expirationDate;var postData={};if(cookie&&cookie!==""){postData.token=decodeURIComponent(cookie)}console.log("postData",postData);if(cookie&&cookie!=null){ajax("POST",domain+endpoints.login,postData,function getLoggedUserSuccess(data){instance.settings.links.userInfo=getLink(data._links,"user");if(data.stayLogged){expirationDate=getExpirationDate()}setCookie("wrs",encodeURIComponent(data.token),expirationDate);if(typeof callback==="function"){callback(data)}},function getLoggedUserFail(status,statusMsg,msg){if(typeof failCallback==="function"){failCallback(status,statusMsg,msg)}})}else{if(typeof failCallback==="function"){failCallback(409,"","")}}},update:function(returnUrl){var returnUrlParam="";returnUrlParam="?url="+encodeURIComponent(returnUrl);window.location=domain+endpoints.update+returnUrlParam},logout:function(callback){var instance=this;setCookie("wrs","","Thu, 01 Jan 1970 00:00:00 GMT");setCookie("socialLogged","","Thu, 01 Jan 1970 00:00:00 GMT");instance.settings.links={};if(typeof callback==="function"){callback()}}};window.Wrs=Wrs})(window);