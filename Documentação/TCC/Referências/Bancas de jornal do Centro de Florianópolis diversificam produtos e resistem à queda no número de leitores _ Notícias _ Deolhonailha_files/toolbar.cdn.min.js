/*!
Markerly Toolbar - v2.0
guts of the toolbar code, initialized from markerly[TYPE].js
BY: Copyright 2013 Markerly <dev@markerly.com>
Monday, December 31st, 2015, 9:10:00 AM 
*/
window.Markerly||(window.Markerly={});var $j;!function(e){try{console.log("init console... done")}catch(r){console={log:function(){}}}void 0===window.Markerly.globals&&(Markerly.globals={BASE_URL:"undefined"!=typeof MARKERLY_ENV?"LOCAL"==MARKERLY_ENV?"http://markerly-toolbar.dev":"http://198.61.212.250/toolbar":"http://platform.markerly.com/toolbar",API_URL:"undefined"!=typeof MARKERLY_ENV?"LOCAL"==MARKERLY_ENV?"http://markerly-toolbar.dev":"http://198.61.212.250/toolbar":"http://platform.markerly.com/toolbar",PIXEL_URL:"undefined"!=typeof MARKERLY_ENV&&"LOCAL"==MARKERLY_ENV?"http://markerly-toolbar.dev":"http://toolbar.markerly.com",CDN_URL:"http://files.markerly.com",PREMIUM_PUBS:["LOCAL"],USER_ID:null,CACHE_BUSTER:Math.floor(1111111*Math.random()),HIGHLIGHT_COLOR:"F3F093",MARKERLY_PAGE_ID:0,MARKERLY_HIGHLIGHT_PAGE_ID:0,MARKERLY_AD_UNIT:0,MARKERLY_CURRENT_HIGHLIGHT:"",MARKERLY_CURRENT_IMAGE:"",MARKERLY_CURRENT_IMAGE_POS:{},MARKERLY_HIGHLIGHT_QUOTE:"",MARKERLY_EXPORT_QUOTE:0,MARKERLY_PAGE_EVENTS:0,SETTINGS:{services:"facebook,twitter,email,pinterest",image_services:"facebook,twitter,pinterest,comments,email",copy_link:"read more at {{link}}",highlight_color:"F3F093",service_color:"000000",text_color:"000000",hover_color:"000000",text_selection_color:!1,tip_type:"",tip_style:"",tip_offset_x:0,tip_offset_y:0,text_sharing:!0,image_sharing:!0,sidebar_sharing:!1,image_sharing_include:"",image_sharing_exclude:"markerly-exclude-image",image_sharing_position:"nw",copy_link_sharing:!1,recommendations:!1,container_restrict:"",container_exclude:".markerly-exclude",url_exclude:[],google_analytics:!1,twitter_attribution:"",sharing_template:""}},"undefined"!=typeof markerly_settings&&(Markerly.globals.SETTINGS=jQuery.extend(Markerly.globals.SETTINGS,markerly_settings)),"undefined"==typeof MARKERLY_CDN&&(MARKERLY_CDN=!1),Markerly.init=function(){if(void 0===e||e("#markerly-toolbar").length<=0){var r=["ma-51546db2c4add"],t=["ma-50db5e871f392"];Markerly.globals.API_URL=Markerly.utils.is_browser("msie")?Markerly.globals.BASE_URL+"/api.php":Markerly.globals.BASE_URL+"/api",Markerly.globals.PUB_ID=Markerly.helpers.get_pub_id(),Markerly.globals.IS_PREMIUM=-1!=e.inArray(Markerly.globals.PUB_ID,Markerly.globals.PREMIUM_PUBS)?!0:!1,-1==e.inArray(Markerly.globals.PUB_ID,t)?(Markerly.utils.markerly_event("load",jQuery(window).width()+","+encodeURIComponent(document.referrer)),Markerly.helpers.is_mobile()&&Markerly.utils.markerly_event("mobile load",jQuery(window).width()+","+encodeURIComponent(document.referrer))):console.log("load exclusion"),-1!=e.inArray(Markerly.globals.PUB_ID,r)&&(console.log("no branding"),Markerly.globals.MARKERLY_NO_BRANDING=1,e("body").append('<style class="markerly-asset" type="text/css">.markerly-tip-icon.markerly-icon, .markerly-share-btn.markerly-share-markerly { display: none !important; }</style>')),""!==Markerly.globals.SETTINGS.container_restrict?e("body").find(Markerly.globals.SETTINGS.container_restrict).addClass("markerly-highlightable"):e("body").children().addClass("markerly-highlightable"),""!==Markerly.globals.SETTINGS.container_exclude&&e("body").find(Markerly.globals.SETTINGS.container_exclude).removeClass("markerly-highlightable"),Markerly.plugins();var l='<div id="markerly-toolbar" class="markerly-toolbar-item markerly-asset" style="display: none"></div>';e("body").prepend(l),Markerly.helpers.is_mobile()?Markerly.selection.mobile_listener():Markerly.selection.highlight_listener(),Markerly.globals.SETTINGS.sidebar_sharing&&Markerly.load.sidebar_sharing(),document.oncontextmenu=function(){0===Markerly.globals.MARKERLY_PAGE_EVENTS&&window.setTimeout(function(){Markerly.utils.markerly_event("right click","")},500)}}},Markerly.plugins=function(){if(e.extend(e.expr[":"],{MARKERLY:function(r){var t=e(r);return void 0!==t.css("font-family")&&"MARKERLY"===t.css("font-family")}}),e.extend({distinct:function(r){var t=[];return e.each(r,function(r,l){-1==e.inArray(l,t)&&t.push(l)}),t}}),Markerly.globals.SETTINGS.text_sharing||Markerly.globals.SETTINGS.image_sharing?(main_css="production"==Markerly.helpers.get_environment()||MARKERLY_CDN?Markerly.globals.CDN_URL+"/main_toolbar_cdn.min.css":Markerly.globals.BASE_URL+"/css/main_toolbar.css",e("head").append('<link class="markerly-asset" rel="stylesheet" type="text/css" href="'+main_css+'" />'),Markerly.helpers.is_mobile()&&(mobile_css="production"==Markerly.helpers.get_environment()||MARKERLY_CDN?Markerly.globals.CDN_URL+"/toolbar_mobile.min.css":Markerly.globals.BASE_URL+"/css/toolbar_mobile.css",e("head").append('<link class="markerly-asset" id="markerly-mobile-css" rel="stylesheet" media="screen" href="'+mobile_css+'" />')),"wide"==Markerly.globals.SETTINGS.tip_type&&e("head").append('<link class="markerly-asset" rel="stylesheet" media="screen" href="http://fonts.googleapis.com/css?family=Metamorphous|Kavoon|Squada+One|Life+Savers|Lobster+Two" />')):jQuery.fn.mtip=function(){},Markerly.helpers.is_publisher()&&-1!=Markerly.helpers.get_url().indexOf("MARKERLY_HEAT_MAP"))console.log("loading heatmaps ..."),Markerly.load.highlights();else try{""!==top.window.location.hash?Markerly.load.highlights():Markerly.load.complete()}catch(r){console.log("error loading hash"),Markerly.load.complete()}},Markerly.helpers={get_user_id:function(){return Markerly.globals.USER_ID},get_user_email:function(){return e("#markerly-login").text()},get_user_name:function(){return e(".login-display-id").text()},get_user_profile_pic:function(){return e(".login-display-logo img").attr("src")},get_url:function(){return"undefined"==typeof MARKERLY_URL_OVERRIDE?window.location.href:MARKERLY_URL_OVERRIDE},get_canonical_url:function(){return 0!==e('link[rel="canonical"]:last').length&&void 0!==e('link[rel="canonical"]:last').attr("href")&&""!==e('link[rel="canonical"]:last').attr("href")?e('link[rel="canonical"]:last').attr("href"):!1},is_mobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},is_publisher:function(){return"undefined"!=typeof MARKERLY_PUB_OVERRIDE&&MARKERLY_PUB_OVERRIDE===!0?!0:!1},get_environment:function(){if(0!==e('script[src*="markerly-"]').length){var r=e('script[src*="markerly-"]').attr("src");return-1!=r.indexOf("markerly.com")?"production":-1!=r.indexOf("198.61.212.250")?"dev":-1!=r.indexOf(".dev")?"local":"unknown"}return"unknown"},get_pub_id:function(){return"undefined"!=typeof MARKERLY_ENV&&"LOCAL"==MARKERLY_ENV?void 0!==e('script[src*="markerly-local"]').attr("src").split("#")[1]?e('script[src*="markerly-local"]').attr("src").split("#")[1].split("?")[0].replace("pub_id=",""):"":0!==e('script[src*="markerly-dev"]').length?"DEV":"undefined"!=typeof MARKERLY_CDN&&void 0!==e('script[src*="markerly-cdn"]').attr("src")?void 0!==e('script[src*="markerly-cdn"]').attr("src").split("#")[1]?e('script[src*="markerly-cdn"]').attr("src").split("#")[1].split("?")[0].replace("pub_id=",""):"":void 0!==e('script[src*="markerly-pub"]').attr("src").split("#")[1]?e('script[src*="markerly-pub"]').attr("src").split("#")[1].split("?")[0].replace("pub_id=",""):""}},Markerly.utils={get_base_url:function(){return"undefined"!=typeof MARKERLY_ENV&&"LOCAL"==MARKERLY_ENV?"http://markerly-toolbar.dev":"undefined"!=typeof MARKERLY_ENV&&"DEV"==MARKERLY_ENV?"http://198.61.212.250/toolbar":"http://markerly.com/toolbar"},in_array:function(e,r,t){for(var l in r)if(t){if(r[l]==e)return!0}else if(-1!=e.indexOf(r[l]))return!0},facebook_page_image:function(){},share_to_facebook:function(r){""!==window.location.hash&&(r=window.location.hash.replace("#_",""));var t=Markerly.helpers.is_publisher()?"http://markerly.com/p/_"+r:"http://markerly.com/d/_"+r,l=document.title,a=Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT,o=0!==e('meta[property="og:image"]').length&&"undefined"!=e('meta[property="og:image"]').attr("content")?e('meta[property="og:image"]').attr("content"):"";if(Markerly.globals.MARKERLY_EXPORT_QUOTE&&(o="http://markerly.com/qi/_"+Markerly.globals.HIGHLIGHT_ID_HASH,t="http://markerly.com/q/_"+Markerly.globals.HIGHLIGHT_ID_HASH),""!==Markerly.globals.SETTINGS.sharing_template&&(a=Markerly.globals.SETTINGS.sharing_template.replace("{{HIGHLIGHT}}",a)),""!==o||Markerly.helpers.is_mobile()||(o="blah"),Markerly.helpers.is_mobile()){var i="https://www.facebook.com/dialog/feed?app_id=263905023706399&link="+encodeURIComponent(t)+"&picture="+encodeURIComponent(o)+"&caption="+encodeURIComponent(l)+"&description="+encodeURIComponent(a)+"&redirect_uri="+encodeURIComponent(t);window.open(i)}else window.open("http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURIComponent(l)+"&p[summary]="+encodeURIComponent(a)+"&p[url]="+encodeURIComponent(t)+"&p[images][0]="+encodeURIComponent(o),"markerly_share_window","location=1,status=1,scrollbars=1, width=700,height=400");if(Markerly.utils.markerly_event("highlight shared facebook",r+"|||"+a),Markerly.globals.MARKERLY_EXPORT_QUOTE){var n=Markerly.utils.random_hash(6);Markerly.globals.HIGHLIGHT_ID_HASH=n}return!1},share_img_db_connector:function(){""!==window.location.hash&&(id=window.location.hash.replace("#_",""));var e=Markerly.utils.random_hash(6);Markerly.globals.HIGHLIGHT_ID_HASH=e,Markerly.selection.save_highlight(2,escape(document.title),encodeURIComponent(Markerly.globals.MARKERLY_CURRENT_IMAGE),"F3F093",Markerly.helpers.get_url(),0,null,null,Markerly.utils.share_complete)},share_img:function(r){Markerly.utils.share_img_db_connector();var t=Markerly.globals.MARKERLY_CURRENT_IMAGE,l="http://markerly.com/p/_"+Markerly.globals.HIGHLIGHT_ID_HASH,a=document.title,o="",i="",n="",s=!1,c="",m=e("img[src='"+t+"']");switch(0!==e(m).length&&(a=void 0!==e(m).attr("alt")&&""!==e(m).attr("alt")?e(m).attr("alt"):void 0!==e(m).attr("title")&&""!==e(m).attr("title")?e(m).attr("title"):document.title),""!==Markerly.globals.SETTINGS.sharing_template&&(a=Markerly.globals.SETTINGS.sharing_template.replace("{{HIGHLIGHT}}",a)),0!==e('iframe[src="'+Markerly.globals.MARKERLY_CURRENT_IMAGE+'"]').length&&(s=!0,i=e('iframe[src="'+Markerly.globals.MARKERLY_CURRENT_IMAGE+'"]')[0].src,n=i.replace("http://www.youtube.com/embed/",""),n=n.replace(/\?.+$/,""),t="http://img.youtube.com/vi/"+n+"/0.jpg"),r){case"facebook":o="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURIComponent(a)+"&p[summary]="+c+"&p[url]="+encodeURIComponent(l)+"&p[images][0]="+encodeURIComponent(t);break;case"twitter":o="https://twitter.com/share?text="+encodeURIComponent(a)+"&url="+encodeURIComponent(l);break;case"pinterest":l=Markerly.helpers.get_url()+"#_"+Markerly.globals.HIGHLIGHT_ID_HASH,o="http://pinterest.com/pin/create/bookmarklet/?media="+encodeURIComponent(t)+"&url="+encodeURIComponent(l)+"&is_video=false&description="+encodeURIComponent(a);break;case"email":o="http://www.markerly.com/toolbar/lib/toolbar_email.php?url="+encodeURIComponent(l)+"&msg="+c+"&title="+encodeURIComponent(a)+"&img="+encodeURIComponent(t);break;case"comments":Markerly.load.comments(t);break;default:return!1}""!==t&&"comments"!=r&&window.open(o,"markerly_share_window","location=1,status=1,scrollbars=1, width=600,height=400"),s?Markerly.utils.markerly_event("video share "+r,t):"comments"==r?Markerly.utils.markerly_event("image comment",Markerly.globals.HIGHLIGHT_ID_HASH+"|||"+t):Markerly.utils.markerly_event("image share "+r,Markerly.globals.HIGHLIGHT_ID_HASH+"|||"+t)},services_share:function(r,t){var l=Markerly.helpers.is_publisher()?"http://markerly.com/p/_"+r:"http://markerly.com/d/_"+r,a=Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT,o=0!==e('meta[property="og:image"]').length&&"undefined"!=e('meta[property="og:image"]').attr("content")?e('meta[property="og:image"]').attr("content"):"";Markerly.services[t].url_shorten||(l=Markerly.helpers.get_url()+"#_"+r),""!==Markerly.globals.SETTINGS.sharing_template&&(a=Markerly.globals.SETTINGS.sharing_template.replace("{{HIGHLIGHT}}",a)),Markerly.globals.MARKERLY_EXPORT_QUOTE&&(o="http://markerly.com/qi/_"+Markerly.globals.HIGHLIGHT_ID_HASH,l="http://markerly.com/q/_"+Markerly.globals.HIGHLIGHT_ID_HASH);var i=Markerly.services[t].endpoint;if(i=i.replace("{{TEMPLATE_URL}}",encodeURIComponent(l)),i=i.replace("{{TEMPLATE_TEXT}}",encodeURIComponent(a)),i=i.replace("{{TEMPLATE_IMAGE}}",encodeURIComponent(o)),"twitter"==t&&""===Markerly.globals.SETTINGS.twitter_attribution&&(i=i.replace("&via=","")),window.open(i,"markerly_share_window","location=1,status=1,scrollbars=1, width=600,height=400"),Markerly.utils.markerly_event("highlight shared "+t,r+"|||"+a),Markerly.globals.MARKERLY_EXPORT_QUOTE){var n=Markerly.utils.random_hash(6);Markerly.globals.HIGHLIGHT_ID_HASH=n}return!1},share_complete:function(){return!1},share_page:function(){Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=top.document.title,Markerly.selection.copy_text()},create_shortened_link:function(){e.getJSON(Markerly.globals.API_URL+"?a=get-bitly-link&url="+encodeURIComponent(Markerly.helpers.get_url())+"&callback=?",function(e){Markerly.utils.short_link(e.shortened_url)})},attribute_highlight:function(){var r=e(".markerly-new-highlight").attr("highlight-id");r&&e.getJSON(Markerly.globals.API_URL+"?a=attribute-highlight&highlight_id="+r+"&user_id="+Markerly.helpers.get_user_id()+"&ad="+Markerly.globals.MARKERLY_AD_UNIT+"&callback=?",function(e){console.log(e)})},is_browser:function(r){return void 0!==e.browser?e.browser[r]:-1!=navigator.userAgent.toLowerCase().indexOf(r)?!0:!1},first_highlight:function(){var r=0;return e("body").find(".markerly-highlight").each(function(){parseInt(e(this).attr("highlight-id"),10)>r&&(r=parseInt(e(this).attr("highlight-id"),10))}),r},mix_panel_event:function(r,t,l){e.getJSON(Markerly.globals.API_URL+"?a=mix-pixel&url="+encodeURIComponent(r)+"&event="+t+"&callback=?",function(r){r&&(console.log("fired mixpanel event -- "+t),e("body").append('<img src="'+r+'" />')),l&&window.setTimeout(function(){top.location.href=l},300)})},markerly_event:function(e,r){var t=r||"",l=Markerly.helpers.get_canonical_url();l||(l=""),Markerly.globals.SETTINGS.google_analytics&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","MARKERLY",e,t])},page_event:function(e,r){Markerly.globals.SETTINGS.google_analytics&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","MARKERLY",event_name,r])},shorten_name:function(e,r){var t=Math.floor(r/2);return e?e.length>r?e.substring(0,t)+"..."+e.substring(e.length-t,e.length):e:""},random_hash:function(e,r){r=r||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var t="",l=0;e>l;l++){var a=Math.floor(Math.random()*r.length);t+=r.substring(a,a+1)}return t},save_hash:function(r){console.log("got id: "+r),e.getJSON(Markerly.globals.API_URL+"?a=update-hash-highlight&highlight_id="+r+"&hash="+Markerly.globals.HIGHLIGHT_ID_HASH+"&callback=?")},send_email:function(){var r=void 0!==Markerly.globals.HIGHLIGHT_ID_HASH?Markerly.helpers.get_url()+"#_"+Markerly.globals.HIGHLIGHT_ID_HASH:Markerly.helpers.get_url(),t=top.document.title,l=Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT,a=0!==e('meta[property="og:image"]').length&&"undefined"!=e('meta[property="og:image"]').attr("content")?e('meta[property="og:image"]').attr("content"):"";Markerly.globals.MARKERLY_EXPORT_QUOTE&&(a="http://markerly.com/qi/_"+Markerly.globals.HIGHLIGHT_ID_HASH),""!==Markerly.globals.SETTINGS.sharing_template&&(l=Markerly.globals.SETTINGS.sharing_template.replace("{{HIGHLIGHT}}",l)),Markerly.helpers.is_mobile()?window.location.href="mailto:?subject="+t+"&body="+l+" "+r:window.open("http://www.markerly.com/toolbar/lib/toolbar_email.php?url="+encodeURIComponent(r)+"&msg="+encodeURIComponent(l)+"&title="+encodeURIComponent(t)+"&img="+encodeURIComponent(a),"markerly_share_window","location=1,status=1,scrollbars=1, width=500,height=500"),Markerly.utils.markerly_event("tip email share",l)},destroy:function(){-1!=window.location.href.indexOf("markerly.com/direct.php")||-1!=window.location.href.indexOf("markerly.com/direct-test.php")?window.location.href=Markerly.helpers.get_url():(e(".markerly-asset").remove(),console.log("killed it"))}},Markerly.load={highlights:function(){var r=!0;if(!Markerly.helpers.is_publisher()){var t=Markerly.selection.get_hover_text();""!==t&&(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=t)}var l=Markerly.globals.API_URL+"?a=get-highlights&user_id="+Markerly.helpers.get_user_id()+"&url="+encodeURIComponent(Markerly.helpers.get_url()),a="";try{a=encodeURIComponent(top.window.location.hash.replace("#",""))}catch(o){console.log("couldn't get hash")}l+="&highlight_hash="+a,e.getJSON(l+"&callback=?",function(e){if(e[0]){for(var t=0;t<e.length;t++){var l=r?!0:!1;if(e[t].text){var a=e[t].text.split("\n"),o=!1;for(var i in a)""!==a[i]&&"string"==typeof a[i]&&((0===a[i].indexOf("http")||0===a[i].indexOf("https"))&&Markerly.selection.highlight_image(a[i]),console.log("looking for: "+a[i]),Markerly.utils.is_browser("msie")||Markerly.selection.highlight_text(e[t].id,a[i],l,e[t].hash),Markerly.helpers.is_publisher()&&!o&&(o=!0,-1!=document.referrer.indexOf("facebook.com")?Markerly.utils.markerly_event("share load facebook",document.referrer):-1!=document.referrer.indexOf("twitter.com")||-1!=document.referrer.indexOf("http://t.co")?Markerly.utils.markerly_event("share load twitter",document.referrer):-1!=document.referrer.indexOf("pinterest.com")?Markerly.utils.markerly_event("share load pinterest",document.referrer):Markerly.utils.markerly_event("share load",document.referrer)))}r=!1}Markerly.selection.highlight_hover()}Markerly.load.complete()})},complete:function(){var r=1;if(window.setTimeout(function(){if(e("body").find(".markerly-loading").remove(),Markerly.helpers.is_mobile()&&e("body").removeClass("markerly-body-override"),-1!=window.location.hash.indexOf("_img")){var r=decodeURIComponent(window.location.hash.split("_img=")[1]),t=r.split("/");t=t[t.length-1],e("body").find('img[src*="'+t+'"]').addClass("markerly-img"),window.setTimeout(function(){Markerly.utils.markerly_event("share load image",r);try{e("html,body").animate({scrollTop:e(".markerly-img").offset().top-20},"slow")}catch(t){console.log("image not found! -- "+r)}},1e3),Markerly.load.comments(r,!0)}Markerly.globals.SETTINGS.highlight_color!=Markerly.globals.HIGHLIGHT_COLOR&&e("body").append('<style type="text/css" class="markerly-asset">.markerly-highlight { background-color: #'+Markerly.globals.SETTINGS.highlight_color+" !important; color: #"+Markerly.globals.SETTINGS.text_color+" !important; }</style>"),"000000"!=Markerly.globals.SETTINGS.service_color&&e("body").append('<style type="text/css" class="markerly-asset">.markerly-arrow-box .markerly-tip-icon, a.markerly-share-btn { background-color: #'+Markerly.globals.SETTINGS.service_color+" !important; }</style>"),"000000"!=Markerly.globals.SETTINGS.hover_color&&e("body").append('<style type="text/css" class="markerly-asset">.markerly-arrow-box .markerly-tip-icon:not(.markerly-icon):hover { background-color: #'+Markerly.globals.SETTINGS.hover_color+" !important; }</style>"),"undefined"!=typeof MARKERLY_DEFER_LOAD&&MARKERLY_DEFER_LOAD&&Markerly.selection.image_listener()},r),document.oncopy=Markerly.selection.copy_listener,Markerly.globals.SETTINGS.image_sharing&&Markerly.selection.image_listener(),Markerly.helpers.is_mobile()){var t=e('<iframe class="markerly-asset" src="http://googleads.g.doubleclick.net/pagead/viewthroughconversion/1013345005/?value=0&amp;label=D-d6CNu41QMQ7dWZ4wM&amp;guid=ON&amp;script=0" style="border: none; width: 1px; height: 1px; overflow: hidden"></iframe>');e("body").append(t)}if(e('input[name="URL_HIGHLIGHT_ID"]').length>0&&""!==e('input[name="URL_HIGHLIGHT_ID"]').val()&&!Markerly.helpers.is_publisher()){console.log("found highlight id "+e('input[name="URL_HIGHLIGHT_ID"]').val());try{e("html,body").animate({scrollTop:e("span[highlight-id='"+e('input[name="URL_HIGHLIGHT_ID"]').val()+"']").offset().top-190},"slow")}catch(l){console.log("scroll error"),console.log(l)}}void 0!==Markerly.globals.MARKERLY_URL_OVERRIDE&&(console.log("no current highlight, removing selection"),e("body").find(".markerly-hover").removeClass("markerly-hover")),""===Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT||Markerly.helpers.is_publisher()||(Markerly.selection.copy_text(),e("html,body").animate({scrollTop:e(".markerly-hover").offset().top-50},100))},comments:function(r,t){{var l=void 0!==r?"http://www.markerly.com/i/?image="+encodeURIComponent(r)+"&r="+encodeURIComponent(Markerly.helpers.get_url().split("#")[0]):Markerly.helpers.get_url()+"#_"+Markerly.globals.HIGHLIGHT_ID_HASH,a=void 0!==r?r:Markerly.globals.HIGHLIGHT_ID_HASH,o='<div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=422206507801579";fjs.parentNode.insertBefore(js, fjs);'+"}(document, 'script', 'facebook-jssdk'));<\/script>",i='<div id="markerly-fb-element" class="fb-comments" data-href="'+l+'" data-num-posts="5" data-width="470"></div>',n=void 0!==r?'<img src="'+r+'" width="200" />':Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT;e(0!==e('img[src="'+r+'"]').length?'img[src="'+r+'"]':'iframe[src="'+Markerly.globals.MARKERLY_CURRENT_IMAGE+'"]')}if("undefined"!=typeof FB&&(o=""),0!==e("#markerly-fb-comments .exit-circle").length&&e("#markerly-fb-comments .exit-circle").click(),e.getJSON(Markerly.globals.API_URL+"?a=sync-fb-comments&url="+encodeURIComponent(l)+"&import_id="+encodeURIComponent(a)+"&callback=?"),0===e("#markerly-fb-comments").length){var s=e(".markerly-image-wrapper .markerly-share-comment").offset().left-35,c=e(".markerly-image-wrapper .markerly-share-comment").offset().top+45,m="markerly-comment-default";void 0!==r&&(m="markerly-comment-image",s=e(".markerly-image-wrapper .markerly-share-comment").offset().left-45),e("body").append('<div class="white-tip" id="markerly-fb-comments" class="'+m+'" style="left: '+s+"px; top: "+c+'px"><div id="markerly-powered-by" onclick="Markerly.utils.markerly_event(\'markerly tip click\', \''+Markerly.helpers.get_url()+'\'); window.setTimeout(function() { window.open(\'http://www.markerly.com/social#gr8\', \'_blank\'); }, 300); return false;">powered by Markerly</div><div class="arrow"></div><div class="arrow-out"></div><div class="exit-circle" onclick="jQuery(this).parent().remove()"></div><div class="markerly-comment-highlight">'+n+"</div>"+i+'<div style="display: none" id="fb-comment-count"><fb:comments-count href='+l+"></fb:comments-count></div></div>"),""===o?FB.XFBML.parse(document.getElementById("markerly-fb-comments"),function(){}):e("body").append('<div class="markerly-asset">'+o+"</div>"),void 0!==t&&e("#markerly-fb-comments").remove(),e("#markerly-fb-comments").hover(function(){e(".markerly-image-wrapper").show()}),window.fbAsyncInit=function(){FB.Event.subscribe("comment.create",function(){e.getJSON(Markerly.globals.API_URL+"?a=sync-fb-comments&url="+encodeURIComponent(l)+"&import_id="+encodeURIComponent(a)+"&callback=?")})}}else e("#markerly-fb-comments").show()},set_comment_text:function(r){""!==e("#fb-comment-count").text()?(r.attr("data-comment-count",e("#fb-comment-count").text()),console.log("comment count: "+e("#fb-comment-count").text())):window.setTimeout(function(){Markerly.load.set_comment_text(r)},500)},sidebar_sharing:function(){var r=e('<div class="markerly-sidebar-sharing markerly-asset"></div>'),t=Markerly.utils.random_hash(6),l=Markerly.selection.set_pub_destinations(t,"static");e(l).appendTo(r),e(r).appendTo("body")}},Markerly.selection={get_hover_text:function(){try{e("body").find(".markerly-hover").hasClass("markerly-pending")||e("body").find(".markerly-hover").contents().unwrap()}catch(r){console.log("no hover text found")}var l,a=null,o="";try{if(Markerly.helpers.is_mobile())l=window.getSelection(),window.getSelection?t=window.getSelection():document.getSelection?t=document.getSelection():document.selection&&(t=document.selection.createRange().text),o=t,""!==o&&Markerly.selection.save_sentences(l.focusNode.parentElement,o,"highlight");else{if(Markerly.utils.is_browser("msie")){l=window.getSelection(),o=""+l,""!==o&&Markerly.selection.save_sentences(l.focusNode.parentElement,o,"highlight"),l.rangeCount&&l.getRangeAt&&(a=l.getRangeAt(0));var i=document.createElement("span");return i.setAttribute("class","markerly-hover"),a.surroundContents(i),o}l=window.getSelection(),o=""+l,""!==o&&Markerly.selection.save_sentences(l.focusNode.parentElement,o,"highlight"),Markerly.globals.SETTINGS.text_sharing&&(l.rangeCount&&l.getRangeAt&&(a=l.getRangeAt(0)),a&&Markerly.selection.select_range.style(a,"markerly-hover"),o&&(Markerly.selection.select_range.clear_selection(),window.find(o)))}return o}catch(r){return""}return""},highlight_text:function(r,t,l,a){var o,i="#"+Markerly.globals.SETTINGS.highlight_color;if(Markerly.utils.is_browser("safari")||Markerly.utils.is_browser("chrome")){for(o=window.getSelection(),document.designMode="on",o.collapse(document.body,0);0===e('font[face="MARKERLY"]').length&&window.find(t);)document.execCommand("HiliteColor",!1,i),document.execCommand("fontname",!1,"MARKERLY"),o.collapseToEnd();document.designMode="off",e('font[face="MARKERLY"]').addClass("markerly-highlight").attr("hash",a).attr("highlight-id",r).removeAttr("face")}else if(Markerly.utils.is_browser("msie")){var n;for(n=void 0!==e.browser&&parseInt(e.browser.version,10)<9?document.body.createTextRange():document.selection.createRange(),document.designMode="on";0===e('font[face="MARKERLY"]').length&&n.findText(t);)n.execCommand("BackColor",!1,i),n.execCommand("fontname",!1,"MARKERLY"),n.collapse(!1);document.designMode="off",e('font[face="MARKERLY"]').addClass("markerly-highlight").attr("hash",a).attr("highlight-id",r).removeAttr("face"),l&&e('font[face="MARKERLY"]').addClass("markerly-first-highlight")}else try{if(o=window.getSelection(),document.designMode="on",o.collapse(document.body,0),0===e('font[face="MARKERLY"]').length&&window.find(t)){var s=l?"markerly-highlight markerly-first-highlight":"markerly-highlight";"affiliate"==r&&(s="markerly-affiliate"),document.execCommand("insertHTML",!1,'<span class="'+s+'" hash="'+a+'" highlight-id="'+r+'">'+t+"</span>"),o.collapseToEnd(),document.designMode="off"}else console.log("highlight not found"),document.designMode="off"}catch(c){return void console.log(c)}},highlight_image:function(r){window.setTimeout(function(){if(0!==e("body").find('img[src*="'+r+'"]').length){e("body").find('img[src*="'+r+'"]').addClass("markerly-img"),Markerly.utils.markerly_event("share load image",r);try{e("html,body").animate({scrollTop:e(".markerly-img").offset().top-20},"slow")}catch(t){console.log("image not found! -- "+r)}}},1e3)},copy_text:function(r,t){var l=Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT;if(e(".markerly-hover").addClass("markerly-highlight markerly-pending").removeClass("markerly-hover"),l.length>500)console.log("long text"),l=l.substring(0,496)+" ...";else{if(e.trim(l).length<1)return void console.log(l);if(void 0===r&&l.split(" ").length<3)return e(".markerly-pending").contents().unwrap(),e(".markerly-tip-wrap").remove(),void alert("Please select more words to highlight.")}if(void 0!==l||""!==l){{var a=Markerly.globals.SETTINGS.highlight_color;Markerly.helpers.get_user_id()}void 0!==r?Markerly.selection.save_highlight(1,escape(document.title),encodeURIComponent(l),a,Markerly.helpers.get_url(),0,null,null,r):Markerly.helpers.is_publisher()||Markerly.selection.save_highlight(1,escape(document.title),encodeURIComponent(l),a,Markerly.helpers.get_url(),null)}void 0!==r&&void 0===t&&e(".markerly-tip-wrap").hide()},highlight_hover:function(){e("body").find(".markerly-highlight").hover(function(){var r=e(this),t=e(r).attr("highlight-id"),l=e(r).attr("hash"),a="",o=0;if(e(".markerly-hover-tip").hide(),Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=e(this).text(),Markerly.helpers.is_mobile())console.log(e(r)),console.log(e("body").find("#markerly-mobile-wrap")),e("body").find("#markerly-mobile-wrap").toggleClass("hovered");else if(0===e("body").find("#markerly-unique-"+t).length){var i=""!==Markerly.globals.SETTINGS.tip_style?Markerly.globals.SETTINGS.tip_style+"-style":"";"wide"==Markerly.globals.SETTINGS.tip_type?(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=e(this).text(),Markerly.selection.quote_text(e(this).text()),a=e('<div class="markerly-hover-tip markerly-tip-wrap markerly-wide-tip markerly-asset '+i+'" id="markerly-unique-'+t+'"><div class="markerly-tip-title">Share This Quote:</div><div class="markerly-tip-quote">'+e(this).text()+'</div><canvas id="markerly-tip-canvas" width="600" height="600" style="border:1px solid #d3d3d3;"></canvas><div class="markerly-tip-dest">'+Markerly.selection.set_pub_destinations(l,"hover")+'</div><div class="markerly-tip-styles"><div class="markerly-quote-style markerly-quote-style-1" data-quote="1" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-2" data-quote="2" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-3" data-quote="3" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-4" data-quote="4" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-5" data-quote="5" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div></div><div class="markerly-tip-arrow"></div><div class="markerly-tip-arrow-out"></div><div class="markerly-powered-by">powered by Markerly</div></div>'),o=e(r).parent().offset().left+e(r).parent().outerWidth()+25):(a=e('<div class="markerly-hover-tip markerly-tip-wrap markerly-arrow-box white-tip markerly-asset '+i+'" id="markerly-unique-'+t+'">'+Markerly.selection.set_pub_destinations(l,"hover")+"</div>"),o=e(r).offset().left+e(r).outerWidth()),e(a).css({top:e(r).offset().top+e(r).outerHeight()/2-20,left:o}).show().hover(function(){},function(){e(".markerly-hover-tip").hide()}),e(a).appendTo("body")}else a=e("body").find("#markerly-unique-"+t).show();"wide"==Markerly.globals.SETTINGS.tip_type&&e(".markerly-tip-wrap:visible .markerly-tip-quote").empty().text(e(r).text().substring(0,140))})},highlight_listener:function(){if(void 0===jQuery.fn.mtip)window.setTimeout(Markerly.selection.highlight_listener,200);else if(Markerly.globals.SETTINGS.text_sharing){var r=Markerly.utils.random_hash(6);Markerly.globals.HIGHLIGHT_ID_HASH=r;var t,l=""!==Markerly.globals.SETTINGS.tip_style?Markerly.globals.SETTINGS.tip_style+"-style":"";t=e("wide"==Markerly.globals.SETTINGS.tip_type?'<div class="markerly-tip-wrap markerly-wide-tip markerly-asset '+l+'"><div class="markerly-tip-title">Share This Quote:</div><div class="markerly-tip-quote"></div><canvas id="markerly-tip-canvas" width="600" height="600" style="border:1px solid #d3d3d3;"></canvas><div class="markerly-tip-dest">'+Markerly.selection.set_pub_destinations(r,"tip")+'</div><div class="markerly-tip-styles"><div class="markerly-quote-style markerly-quote-style-1" data-quote="1" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-2" data-quote="2" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-3" data-quote="3" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-4" data-quote="4" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div><div class="markerly-quote-style markerly-quote-style-5" data-quote="5" onclick="Markerly.selection.toggle_quote_style(this)">&#147;</div></div><div class="markerly-tip-arrow"></div><div class="markerly-tip-arrow-out"></div><div class="markerly-powered-by"><span class="markerly-powered-by-click" onclick="jQuery(\'.markerly-icon\').click()">powered by Markerly</div></div>':'<div class="markerly-tip-wrap markerly-arrow-box white-tip markerly-asset '+l+'">'+Markerly.selection.set_pub_destinations(r,"tip")+"</div>");
var a=Markerly.globals.SETTINGS.tip_offset_y;"wide"==Markerly.globals.SETTINGS.tip_type&&(a=-50),"ma-50db5e871f392"==Markerly.globals.PUB_ID&&(a+=-50),e(".markerly-highlightable").mtip({selector:".markerly-tip-wrap",exclude:Markerly.globals.SETTINGS.container_exclude,top_offset:a,left_offset:Markerly.globals.SETTINGS.tip_offset_x,tip_type:Markerly.globals.SETTINGS.tip_type,tip_shown:function(r){if(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=r,Markerly.utils.markerly_event("text highlighted",r),void 0!==window.getSelection&&Markerly.selection.save_sentences(window.getSelection().focusNode.parentElement,r,"highlight"),"wide"==Markerly.globals.SETTINGS.tip_type){var t=e(window.getSelection().focusNode).parent().width()+e(window.getSelection().focusNode).parent().offset().left+25;e(".markerly-tip-wrap").css("left",t),e(".markerly-tip-wrap .markerly-tip-quote").empty().text(r.substring(0,140)),Markerly.selection.quote_text(r),e(".markerly-quote-style").removeClass("active"),e(".markerly-tip-quote").attr("class","markerly-tip-quote"),Markerly.globals.MARKERLY_EXPORT_QUOTE=0,e(".markerly-tip-wrap .pn-icon").hide()}}}),e(t).appendTo("body")}else e(".markerly-highlightable").mouseup(function(){var e=Markerly.selection.get_hover_text();""!==e&&(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=e,Markerly.utils.markerly_event("text highlighted",e))})},mobile_listener:function(){var r=Markerly.utils.random_hash(6),t="",l=null,a=2e3;Markerly.globals.HIGHLIGHT_ID_HASH=r;var o,i='<a title="Share to Facebook" target="_blank" class="markerly-mobile-menu-icon fb-icon" href="#" onclick="event.preventDefault(); return false" onmousedown="event.preventDefault(); Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.share_to_facebook(\''+r+'\'); return false" rel="nofollow"></a>',n='<a title="Share to Twitter " target="_blank" class="markerly-mobile-menu-icon tw-icon" href="#" onclick="event.preventDefault(); return false" onmousedown="event.preventDefault(); Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.services_share(\''+r+'\', {{TWITTER}}); return false" rel="nofollow"></a>',s='<a title="Share to LinkedIn" target="_blank" class="markerly-mobile-menu-icon li-icon" href="#" onclick="event.preventDefault(); return false" onmousedown="event.preventDefault(); Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.services_share(\''+r+'\', {{LINKEDIN}}); return false" rel="nofollow"></a>',c='<a title="Email" class="markerly-mobile-menu-icon em-icon" href="#" onclick="event.preventDefault(); return false" onmousedown="event.preventDefault(); Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.send_email(); return false" rel="nofollow"></a>';n=n.replace("{{TWITTER}}","'twitter'"),s=s.replace("{{LINKEDIN}}","'linkedin'"),0===e("body").find("#markerly-mobile-wrap").length?(o=e('<div id="markerly-mobile-wrap"><div class="markerly-mobile-menu-icon-wrap">'+i+n+c+'<div class="markerly-clearer"></div></div></div>'),e(o).appendTo("body")):o=e("body").find("#markerly-mobile-wrap"),document.addEventListener("touchstart",function(){window.setTimeout(function(){""+window.getSelection()},500)},!1),document.addEventListener("touchend",function(r){if(t=""+window.getSelection(),window.clearTimeout(l),l=window.setTimeout(function(){""!==t&&""!==e.trim(t)&&Markerly.utils.markerly_event("text highlighted mobile",t)},a),""!==t&&""!==e.trim(t)&&Markerly.globals.SETTINGS.text_sharing){if(void 0!==r.explicitOriginalTarget&&void 0!==r.explicitOriginalTarget.outerHTML&&"markerly-mobile-wrap"==e(r.explicitOriginalTarget.outerHTML).attr("id"))return!1;Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=t,e(o).addClass("hovered")}else Markerly.globals.SETTINGS.text_sharing&&e(o).removeClass("hovered")},!1),document.addEventListener("selectionchange",function(){t=""+window.getSelection(),""===t&&e(o).removeClass("hovered"),Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=t,window.clearTimeout(l),l=window.setTimeout(function(){""!==t&&""!==e.trim(t)&&Markerly.utils.markerly_event("text highlighted mobile",t)},a)},!1),document.addEventListener("gestureend",function(r){var t=""!==e(r.target).text()?e(r.target).text().substring(0,500):"";Markerly.utils.markerly_event("mobile pinch",t)})},copy_listener:function(){(void 0===Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT||""===Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT)&&(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=""+window.getSelection()),Markerly.utils.markerly_event("text copied",Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT),selection=window.getSelection(),Markerly.selection.save_sentences(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT_NODE,""+selection,"copy")},image_listener:function(){var r=Markerly.selection.set_pub_destinations("","image"),t='<div class="markerly-image-wrapper markerly-image-pos-'+Markerly.globals.SETTINGS.image_sharing_position+' markerly-asset">'+r+'<div class="clearer"></div></div>';e(t).appendTo("body");var l=null,a=Markerly.globals.SETTINGS.image_sharing_exclude.replace(".",""),o=Markerly.globals.SETTINGS.image_sharing_include.replace(".",""),i=null,n=e(""!==Markerly.globals.SETTINGS.container_restrict?Markerly.globals.SETTINGS.container_restrict:"body");n.delegate('img, iframe[src*="http://www.youtube.com/embed/"]',"hover",function(r){if(!e(this).hasClass(a)&&(""===o||""!==o&&e(this).hasClass(o))&&(r.stopPropagation(),l=e(this),Markerly.globals.MARKERLY_CURRENT_IMAGE=e(this)[0].src,e(this).width()>100&&e(this).height()>100)){Markerly.globals.IS_PREMIUM&&(window.clearTimeout(i),i=window.setTimeout(function(){e(".markerly-image-wrapper:visible").length>0&&Markerly.utils.markerly_event("image hover",Markerly.globals.MARKERLY_CURRENT_IMAGE)},1500)),Markerly.globals.MARKERLY_CURRENT_IMAGE_POS={left:e(this).offset().left,right:e(this).offset().left+e(this).width(),top:e(this).offset().top,bottom:e(this).offset().top+e(this).height()};var t=function(r){var t={};switch(Markerly.globals.SETTINGS.image_sharing_position){case"nw":t={top:e(r).offset().top,left:e(r).offset().left};break;case"ne":t={top:e(r).offset().top,left:e(r).offset().left+e(r).width()-e(".markerly-image-wrapper").width()};break;case"se":t={top:e(r).offset().top+e(r).height()-e(".markerly-image-wrapper").outerHeight(),left:e(r).offset().left+e(r).width()-e(".markerly-image-wrapper").width()};break;case"sw":t={top:e(r).offset().top+e(r).height()-e(".markerly-image-wrapper").outerHeight(),left:e(r).offset().left};break;default:t={top:e(r).offset().top,left:e(r).offset().left}}return"ma-50db5e871f392"==Markerly.globals.PUB_ID&&(t.top=Markerly.globals.SETTINGS.tip_offset_y+t.top-50),t}(e(this));e(".markerly-image-wrapper").css(t).show(),void 0!==e(this).attr("data-comment-count")?e(".markerly-image-wrapper").find(".markerly-share-comment").empty().text(e(this).attr("data-comment-count")).attr("style","width: auto !important; color: #fff !important; line-height: 21px; padding-left: 27px; padding-right: 9px;"):e(".markerly-image-wrapper").find(".markerly-share-comment").empty().attr("style",""),(Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.left>r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.right<r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.top>r.pageY||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.bottom<r.pageY)&&e(".markerly-image-wrapper").hide()}}),n.mouseleave(function(r){Markerly.globals.IS_PREMIUM&&window.clearTimeout(i),(Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.left>r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.right<r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.top>r.pageY||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.bottom<r.pageY)&&e(".markerly-image-wrapper").hide()}),e(".markerly-image-wrapper").mouseleave(function(r){Markerly.globals.IS_PREMIUM&&window.clearTimeout(i),(Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.left>r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.right<r.pageX||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.top>r.pageY||Markerly.globals.MARKERLY_CURRENT_IMAGE_POS.bottom<r.pageY)&&e(".markerly-image-wrapper").hide()}),Markerly.globals.IS_PREMIUM&&n.delegate('img, iframe[src*="http://www.youtube.com/embed/"]',"mousedown",function(e){3===e.which?Markerly.utils.markerly_event("image right click",Markerly.globals.MARKERLY_CURRENT_IMAGE):Markerly.utils.markerly_event("image click",Markerly.globals.MARKERLY_CURRENT_IMAGE)})},set_pub_destinations:function(e,r){for(var t="",l="image"==r?Markerly.globals.SETTINGS.image_services:Markerly.globals.SETTINGS.services,a=Markerly.helpers.is_publisher()?"markerly,"+l:l,o=a.split(","),i=0;i<o.length;i++)if("image"==r||"pinterest"!=o[i]||"wide"==Markerly.globals.SETTINGS.tip_type)if("share_link"==o[i])t+='<div class="markerly-clearer"></div><input id="markerly-copy-random-link" class="markerly-tip-text" value="http://markerly.com/d/_'+e+'" onmouseup="event.stopPropagation()" onfocus="jQuery(this).select(); Markerly.selection.copy_text(Markerly.utils.save_hash, true);" />';else if(void 0!==Markerly.services[o[i]]){var n=Markerly.services[o[i]],s=r+"_css_class",c=n["action_"+r].replace("{{TEMPLATE_ID}}",e),m="markerly"==n.short_name||"comments"==n.short_name?n.display_name:"Share to "+n.display_name;t+="image"==r||"static"==r?'<a href="#" class="'+Markerly.services[s].replace("{{SHORT_NAME}}",n.short_name)+'" alt="'+m+'" title="'+m+'" onclick="'+c+'"></a>':'<a href="#" class="'+Markerly.services[s].replace("{{SHORT_NAME}}",n.short_name)+'" alt="'+m+'" title="'+m+"\" onclick=\"Markerly.selection.save_sentences(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT_NODE, Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT, 'share');"+c+'"></a>'}return t},lookup:function(){e(".markerly-hover:first").text()&&e.getJSON(Markerly.globals.API_URL+"?a=google-search&q="+encodeURIComponent(e(".markerly-hover").text())+"&url="+encodeURIComponent(Markerly.helpers.get_url())+"&ad="+Markerly.globals.MARKERLY_AD_UNIT+"&callback=?",function(r){if(r.responseData&&r.responseData.results){var t=r.responseData.results,l="";for(var a in t)t[a].title&&(l+='<div class="search-item"><div class="search-title"><a target="_blank" href="http://www.markerly.com/direct.php?url='+encodeURIComponent(t[a].url)+'">'+t[a].title+'</a></div><div class="search-descr">'+t[a].content+'</div><div class="search-link"><a target="_blank" href="'+t[a].url+'">'+t[a].visibleUrl+"</a></div></div>");l='<div id="markerly-google-search" class="markerly-overlay-tip overlay-white"><div class="markerly-search-header">Search Results</div>'+l+'<div class="markerly-logo"></div><div class="markerly-exit-circle" onclick="jQuery(this).parent().remove(); jQuery(\'#markerly-bg-hider\').remove()"></div></div>',e('<div id="markerly-bg-hider" class="markerly-asset"></div>').css({height:e("body").height()-200}).prependTo("body"),e("body").append(l)}})},save_sentences:function(r,t,l){Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT_NODE=r;var a=e(r).text().split(". "),o=t.split(". "),i=[];try{for(var n=0;n<a.length;n++)for(var s=0;s<o.length;s++)-1!=a[n].indexOf(o[s])&&a[n].split(" ").length>2&&i.push(e.trim(a[n]));Markerly.utils.markerly_event("sentence "+l,encodeURIComponent(i.join("[*m*]")))}catch(c){console.log(c)}},save_highlight:function(r,t,l,a,o,i,n,s,c){if(Markerly.globals.MARKERLY_EXPORT_QUOTE){var m={type:r,pub_id:Markerly.helpers.get_pub_id(),title:t,highlight:l,url:encodeURIComponent(o),hash:Markerly.globals.HIGHLIGHT_ID_HASH,quote:Markerly.globals.MARKERLY_HIGHLIGHT_QUOTE};e.post(Markerly.globals.API_URL+"?a=save-img",m)}else e.getJSON(Markerly.globals.API_URL+"?a=save-content-get&type="+r+"&pub_id="+Markerly.helpers.get_pub_id()+"&title="+t+"&highlight="+l+"&url="+encodeURIComponent(o)+"&hash="+Markerly.globals.HIGHLIGHT_ID_HASH+"&remark=0&fb=0&ad=0&page_id=0&callback=?",function(r){Markerly.globals.MARKERLY_HIGHLIGHT_PAGE_ID=parseInt(r.page_id,10),void 0!==c?c(r.highlight_id):e(".markerly-pending").attr("highlight-id",highlight_id).attr("link",r.shortened_url).removeClass("markerly-pending").addClass("markerly-new-highlight")});return!1},toggle_quote_style:function(r){if(e(r).hasClass("active"))e(".markerly-quote-style").removeClass("active"),e(".markerly-tip-quote").attr("class","markerly-tip-quote"),Markerly.globals.MARKERLY_EXPORT_QUOTE=0,e(".markerly-tip-wrap .pn-icon").hide();else{e(".markerly-quote-style").removeClass("active"),e(r).addClass("active");var t=e(".markerly-quote-style.active").css("background-image");t=/^url\((['"]?)(.*)\1\)$/.exec(t),e(".markerly-tip-quote").find(".markerly-quote-image").remove(),e(".markerly-tip-quote").attr("class","markerly-tip-quote markerly-quote-style-"+e(r).attr("data-quote")).append('<div class="markerly-quote-image markerly-quote-image-'+e(r).attr("data-quote")+'"></div>'),Markerly.globals.MARKERLY_EXPORT_QUOTE=1,Markerly.selection.quote_text(Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT),e(".markerly-tip-wrap .pn-icon").css("display","inline-block")}},quote_text:function(r){var t=document.getElementById("markerly-tip-canvas"),l=t.getContext("2d");r=r.substring(0,250),l.clearRect(0,0,t.width,t.height);var a=new Image,o=0!==e(".markerly-quote-style.active").length?e(".markerly-quote-style.active").attr("data-quote"):0;0===o?a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=":(a.src=e(".markerly-quote-style-"+o).css("background-image").replace(/.+data/,"data"),a.src=a.src.replace('")',"")),a.onload=function(){var i=l.createPattern(a,"repeat");l.fillStyle=i,l.fillRect(0,0,t.width,t.height);var n=60;r.length>100?n=40:r.length>75?n=50:r.length>50&&(n=60);var s=n+"px "+e(".markerly-tip-quote").css("font-family").replace(/\"/g,"");l.font=s,l.fillStyle=0!==o?e(".markerly-tip-quote").css("color"):"black";for(var c=r.split(" "),m="",y=480,d=n+5,p=1,g=(t.width-y)/2,_=60,h=0;h<c.length;h++){var k=m+c[h]+" ",u=l.measureText(k),M=u.width;M>y?(l.fillText(m,g,_),m=c[h]+" ",_+=d,p++):m=k}l.fillText(m,g,_),Markerly.globals.MARKERLY_HIGHLIGHT_QUOTE=t.toDataURL("image/png")}},static_share:function(e){var r=Markerly.globals.SETTINGS.highlight_color;Markerly.globals.MARKERLY_CURRENT_HIGHLIGHT=document.title,Markerly.selection.save_highlight(1,escape(document.title),escape(document.title),r,Markerly.helpers.get_url(),0,null,null,e)},select_range:{style:function(r,t){var l=r.startContainer.splitText(r.startOffset),a=r.endContainer.splitText(r.endOffset).previousSibling;r.setStart(l,0),r.setEnd(a,a.length);var o=Markerly.selection.select_range.get_nodes_in_range(r);for(i=0;i<o.length;i++)if(""!==e.trim(e(o[i]).text())){var n=document.createElement("span");n.setAttribute("class",t),n.appendChild(document.createTextNode(o[i].nodeValue)),o[i].parentNode.replaceChild(n,o[i])}},get_nodes_in_range:function(e){var r,t=e.startContainer,l=e.endContainer,a=e.commonAncestorContainer,o=[];for(r=t.parentNode;r&&(3==r.nodeType&&o.push(r),r!=a);r=r.parentNode);for(o.reverse(),r=t;r&&(3==r.nodeType&&o.push(r),r!=l);r=Markerly.selection.select_range.get_next_node(r));return o},get_next_node:function(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},clear_selection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},copy_link:function(e){var r;document.selection?(r=document.body.createTextRange(),r.moveToElementText(document.getElementById(e)),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(document.getElementById(e)),window.getSelection().addRange(range))}}},Markerly.services={tip_css_class:"markerly-tip-icon {{SHORT_NAME}}-icon",hover_css_class:"markerly-tip-icon {{SHORT_NAME}}-icon",mobile_css_class:"markerly-mobile-menu-icon {{SHORT_NAME}}-icon",image_css_class:"markerly-share-btn markerly-share-{{SHORT_NAME}}",static_css_class:"markerly-static-icon {{SHORT_NAME}}-icon",facebook:{display_name:"Facebook",short_name:"fb",action_tip:"Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.share_to_facebook('{{TEMPLATE_ID}}'); return false",action_hover:"Markerly.utils.share_to_facebook('{{TEMPLATE_ID}}'); return false",action_image:"Markerly.utils.share_img('facebook'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.share_to_facebook('{{TEMPLATE_ID}}'); return false",endpoint:"",url_shorten:!0},twitter:{display_name:"Twitter",short_name:"tw",action_tip:"Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'twitter'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'twitter'); return false",action_image:"Markerly.utils.share_img('twitter'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'twitter'); return false",endpoint:"https://twitter.com/share?url={{TEMPLATE_URL}}&text={{TEMPLATE_TEXT}}&via="+Markerly.globals.SETTINGS.twitter_attribution,endpoint_mobile:"twitter://post?message={{TEMPLATE_TEXT}}%20{{TEMPLATE_URL}}",url_shorten:!0},email:{display_name:"Email",short_name:"em",action_tip:"Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.send_email(); return false",action_hover:"Markerly.utils.send_email(); return false",action_image:"Markerly.utils.share_img('email'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.send_email(); return false",endpoint:"",url_shorten:!0},pinterest:{display_name:"Pinterest",short_name:"pn",action_tip:"Markerly.selection.copy_text(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'pinterest'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'twitter'); return false",action_image:"Markerly.utils.share_img('pinterest'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'pinterest'); return false",endpoint:"http://pinterest.com/pin/create/bookmarklet/?media={{TEMPLATE_IMAGE}}&url={{TEMPLATE_URL}}&is_video=false&description={{TEMPLATE_TEXT}}",url_shorten:!1},linkedin:{display_name:"LinkedIn",short_name:"li",action_tip:"Markerly.selection.copy_text(); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'linkedin'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'linkedin'); return false",action_image:"Markerly.utils.share_img('linkedin'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'linkedin'); return false",endpoint:"https://www.linkedin.com/cws/share?url={{TEMPLATE_URL}}",url_shorten:!1},evernote:{display_name:"Evernote",short_name:"ev",action_tip:"Markerly.selection.copy_text(); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'evernote'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'evernote'); return false",action_image:"Markerly.utils.share_img('evernote'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'evernote'); return false",endpoint:"https://www.evernote.com/noteit.action?url={{TEMPLATE_URL}}&title={{TEMPLATE_TEXT}}",url_shorten:!1},googleplus:{display_name:"Google+",short_name:"gp",action_tip:"Markerly.selection.copy_text(); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'googleplus'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'googleplus'); return false",action_image:"Markerly.utils.share_img('googleplus'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'googleplus'); return false",endpoint:"https://plus.google.com/share?url={{TEMPLATE_URL}}",url_shorten:!1},weibo:{display_name:"Weibo",short_name:"we",action_tip:"Markerly.selection.copy_text(); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'weibo'); return false",action_hover:"Markerly.utils.services_share('{{TEMPLATE_ID}}', 'weibo'); return false",action_image:"Markerly.utils.share_img('weibo'); return false",action_static:"Markerly.selection.static_share(Markerly.utils.share_complete); Markerly.utils.services_share('{{TEMPLATE_ID}}', 'weibo'); return false",endpoint:"http://service.weibo.com/share/share.php?url={{TEMPLATE_URL}}&appkey=&title={{TEMPLATE_TEXT}}&pic=&ralateUid=&language=zh_cn",url_shorten:!1},comments:{display_name:"Comments",short_name:"comment",action_tip:"Markerly.selection.copy_text(); Markerly.load.comments('{{TEMPLATE_ID}}'); return false",action_hover:"Markerly.load.comments('{{TEMPLATE_ID}}'); return false",action_image:"Markerly.utils.share_img('comments'); return false",endpoint:"",url_shorten:!0},highlight:{display_name:"Highlight",short_name:"highlight",action_tip:"Markerly.selection.copy_text();",action_hover:"",endpoint:"",url_shorten:!0},markerly:{display_name:"Get Markerly!",short_name:"markerly",action_tip:"Markerly.utils.markerly_event('markerly tip click', '"+Markerly.helpers.get_url()+"'); window.setTimeout(function() { window.open('http://www.markerly.com/gtc#gr8', '_blank'); }, 300); return false;",action_hover:"",action_image:"Markerly.utils.markerly_event('markerly image tip click', '"+Markerly.helpers.get_url()+"'); window.setTimeout(function() { window.open('http://www.markerly.com/gtc#gr8', '_blank'); }, 300); return false",action_static:"Markerly.utils.markerly_event('markerly tip click', '"+Markerly.helpers.get_url()+"'); window.setTimeout(function() { window.open('http://www.markerly.com/gtc#gr8', '_blank'); }, 300); return false;",endpoint:""}},Markerly.page_events=function(){var r,t=1e4,l=0,a=0,o=0,i=0;e(document).keyup(function(){a++}),e(document).mousedown(function(r){0===r.button?(e(r.target).is("a")&&Markerly.utils.page_event(803,link_href),o++):i++}),r=window.setInterval(function(){l+=t,0===o&&0===i&&0===a?console.log("no event(s)"):Markerly.utils.page_event(encodeURIComponent("803="+o+"&805="+i+"&806="+a),0),a=0,i=0,o=0},t)},Markerly.poll={init:function(){e.getJSON(Markerly.globals.BASE_URL+"/poll?pub_id="+Markerly.globals.PUB_ID+"&url="+encodeURIComponent(Markerly.helpers.get_url())+"&check_uniques=1&callback=?",function(e){void 0!==e&&e.new_user&&Markerly.poll.launch(e.poll_id,e.answer_length)})},launch:function(r,t){Markerly.utils.markerly_event("poll load",r);var l=Markerly.poll.get_height(t),a=Markerly.helpers.is_mobile()?"&mobile=1":"",o='<div class="markerly-poll-wrapper markerly-ignore" style="height: '+l+'px"><iframe class="markerly-asset markerly-ignore markerly-poll-frame" style="height: '+l+'px" src="'+Markerly.globals.BASE_URL+"/poll?load=1&pub_id="+Markerly.globals.PUB_ID+"&poll_id="+r+"&url="+encodeURIComponent(Markerly.helpers.get_url())+a+'"></iframe><div class="markerly-poll-closer markerly-ignore">x</div></div>';e("body").append(o),jQuery(".markerly-poll-closer").click(function(){Markerly.poll.close()})},get_height:function(e){var r=110;return r+30*e},close:function(){e("body").find(".markerly-poll-wrapper").remove()}},Markerly.widget={settings:{widget_id:"",widget_type:1,widget_text:"",widget_css:"",widget_delay:1500},init:function(){e.getJSON(Markerly.globals.BASE_URL+"/widget?pub_id="+Markerly.globals.PUB_ID+"&url="+encodeURIComponent(Markerly.helpers.get_url())+"&check_uniques=1&callback=?",function(e){void 0!==e&&e.new_user&&Markerly.widget.launch(e.widget_id,e.widget_text)})},launch:function(r,t){var l=1;Markerly.utils.markerly_event("widget load",r);var a='<div class="markerly-widget-wrapper markerly-widget-wrapper-type-1 markerly-ignore"><iframe class="markerly-asset markerly-ignore markerly-widget-frame" src="'+Markerly.globals.BASE_URL+"/widget?load=1&pub_id="+Markerly.globals.PUB_ID+"&widget_id="+r+"&url="+encodeURIComponent(Markerly.helpers.get_url())+"&txt="+encodeURIComponent(t)+'"></iframe><div class="markerly-widget-closer markerly-ignore">x</div></div>';e("body").append(a),e(".markerly-widget-closer").click(function(){1===l?Markerly.widget.toggle_bar():Markerly.widget.close()}),window.setTimeout(function(){console.log("about to launch widget ..."),1===l?Markerly.widget.toggle_bar():e(".markerly-widget-wrapper").addClass("markerly-widget-visible")},Markerly.widget.settings.widget_delay)},toggle_bar:function(){e(".markerly-widget-wrapper").hasClass("markerly-widget-visible")?e(".markerly-widget-wrapper").removeClass("markerly-widget-visible"):window.setTimeout(function(){e(".markerly-widget-wrapper").addClass("markerly-widget-visible")},100)},close:function(){e(".markerly-widget-wrapper").removeClass("markerly-widget-visible"),window.setTimeout(function(){e(".markerly-widget-wrapper").remove()},1500)}})}(jQuery),function(e){function r(e){var r,t=e;try{for(r=e.previousSibling;r&&1!=r.nodeType;)t=r,r=r.previousSibling}catch(l){return console.log(l),topOffset=-15,t}return r?r:t}function t(r,t){return e(r.target)[0]==e(t)[0]?!0:!1}e.event.special.tripleclick={setup:function(){var e=this,r=jQuery(e);r.bind("click",jQuery.event.special.tripleclick.handler)},teardown:function(){var e=this,r=jQuery(e);r.unbind("click",jQuery.event.special.tripleclick.handler)},handler:function(e){var r=this,t=jQuery(r),l=t.data("clicks")||0;l+=1,3===l&&(l=0,e.type="tripleclick",jQuery.event.handle.apply(this,arguments)),t.data("clicks",l)}};var l={init:function(l){var a=e.extend({selector:"markerly-tip-wrap",minWords:1,exclude:"",textVariable:null,top_offset:0,left_offset:0,tip_type:"",tip_shown:function(){},tip_hidden:function(){}},l),o=0,i=a.top_offset,n=a.left_offset,s=a.exclude,c=1e12,m=!1;return this.each(function(){function l(t,l){if("INPUT"!=l.target.nodeName&&"TEXTAREA"!=l.target.nodeName){var m="<span class='markerly-selection-template'><span>";if(i=a.top_offset,n=a.left_offset,s=a.exclude,o===t){var y,d,p,g,_,h="Microsoft Internet Explorer"===navigator.appName;if(window.getSelection){if(y=window.getSelection(),g=""+y,""===e.trim(g)||g.split(" ").length<a.minWords)return;if(a.textVariable&&(window[a.textVariable]=g),a.tip_shown.call(this,g),y.getRangeAt&&y.rangeCount){d=window.getSelection().getRangeAt(0),p=d.cloneRange(),p.collapse(!1);var k=document.createElement("div");k.innerHTML=m;var u=document.createElement("span");if(0===d.startOffset&&0===d.endOffset){var M=p.startContainer,f=r(M);try{p.selectNode(f.lastChild)}catch(b){n=40,i=-15,p.selectNode(f)}p.collapse(!1)}else 0===d.endOffset&&(i=-25,n=40);if(o!==t)return;e(a.selector).stop().fadeOut("fast"),h||e.trim(g)!==e.trim(p.startContainer.innerText)?h||e.trim(g)!==e.trim(p.endContainer.innerText)?(p.insertNode(u),_=e(u).offset(),u.parentNode.removeChild(u)):(p.endContainer.innerHTML+="<span class='markerly-selection-template'>&nbsp;</span>",_=e(".markerly-selection-template").offset(),e(".markerly-selection-template").remove()):(p.startContainer.innerHTML+="<span class='markerly-selection-template'>&nbsp;</span>",_=e(".markerly-selection-template").offset(),e(".markerly-selection-template").remove())}}else document.selection&&document.selection.createRange&&(d=document.selection.createRange(),p=d.duplicate(),d.collapse(!1),d.pasteHTML(m),p.setEndPoint("EndToEnd",d),p.select(),_=e(".markerly-selection-template").offset(),e(".markerly-selection-template").remove());if((new Date).getTime()-c>1e3){if(c=(new Date).getTime(),0===_.left&&0===_.top)return;"wide"!==a.tip_type&&e(a.selector).css("left",_.left+n+"px");var v=_.top+i-12;0>v&&(v=5),"auto"!=e("body").css("top")&&(v-=parseInt(e("body").css("top"),10)),e(a.selector).css("top",v+"px"),e(a.selector).stop().fadeIn("fast")}}}}e(a.selector).stop().stop().fadeOut("fast"),e(a.selector).css("position","absolute"),e(document).bind("mouseup.markerly-highlightable",function(){}),e(this).bind("mouseup.markerly-highlightable",function(e){""!==s&&t(e,s)||(o=1,clicks=0,setTimeout(function(){l(1,e)},300))}),e(this).bind("tripleclick.markerly-highlightable",function(e){""!==s&&t(e,s)||(o=3,setTimeout(function(){l(3,e)},200))}),e(this).bind("dblclick.markerly-highlightable",function(e){""!==s&&t(e,s)||(o=2,setTimeout(function(){l(2,e)},300))}),e(this).bind("mousedown.markerly-highlightable",function(r){""!==s&&t(r,s)||(e(a.selector).stop().stop().fadeOut("fast"),a.tip_hidden.call(this,""),m=!0)})})},destroy:function(){return this.each(function(){e(document).unbind("mouseup.markerly-highlightable"),e(this).unbind("mouseup.markerly-highlightable"),e(this).unbind("tripleclick.markerly-highlightable"),e(this).unbind("dblclick.markerly-highlightable"),e(this).unbind("mousedown.markerly-highlightable")})}};e.fn.mtip=function(r){return l[r]?l[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?void e.error("Method "+r+" does not exist on jQuery.mtip"):l.init.apply(this,arguments)}}(jQuery);